<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- Find user by login(email) -->

    <bean id="findUserByLogin" class="java.lang.String">
        <constructor-arg index="0" value="

            SELECT user.* FROM user WHERE user_email = :login
        "/>
    </bean>


    <!-- Find all the Badges that were assigned User -->

    <bean id="findBadgesByUserId" class="java.lang.String">
        <constructor-arg index="0" value="

            SELECT badge.* FROM badge

                JOIN user_badge ON ub_badge_id = bdg_id

                JOIN user ON ub_user_id = user_id

            WHERE user_id = :userId
        "/>
    </bean>


    <!-- Find all Question by User id -->

    <bean id="findQuestionsByUserId" class="java.lang.String">
        <constructor-arg index="0" value="

            SELECT question.* FROM question

                JOIN user ON qs_user_id = user_id

            WHERE user_id = :userId
        "/>
    </bean>


    <!-- Find all Question by array of Tag id -->

    <bean id="findQuestionsByTagsId" class="java.lang.String">
        <constructor-arg index="0" value="

            SELECT question.* FROM question

                JOIN question_tag ON qs_id = qt_question_id

                JOIN tag ON tag_id = qt_tag_id

            WHERE tag_id IN(:arrTagId)
        "/>
    </bean>


    <!-- Find all Answers by User id -->

    <bean id="findAnswersByUserId" class="java.lang.String">
        <constructor-arg index="0" value="

            SELECT answer.* FROM answer

                JOIN user ON asw_user_id = user_id

            WHERE user_id = :userId
        "/>
    </bean>


    <!-- Find all Answers by Question id -->

    <bean id="findAnswersByQuestionId" class="java.lang.String">
        <constructor-arg index="0" value="

            SELECT answer.* FROM answer

                JOIN question ON asw_question_id = qs_id

            WHERE qs_id = :questionId
        "/>
    </bean>


    <!-- Find all Comments by Question id -->

    <bean id="findCommentsByQuestionId" class="java.lang.String">
        <constructor-arg index="0" value="

            SELECT comment.* FROM comment

                JOIN question ON cm_question_id = qs_id

            WHERE qs_id = :questionId
        "/>
    </bean>


    <!-- User activity -->
    <bean id="findUserActivity" class="java.lang.String">
        <constructor-arg index="0" value="

            (SELECT cm_id, cm_content, cm_created FROM comment, user

                WHERE user_id = :userId AND cm_user_id = user_id)

                UNION

            (SELECT qs_id, qs_content, qs_created FROM question, user

                WHERE user_id = :userId AND qs_user_id = user_id)

                UNION

            (SELECT asw_id, asw_content, asw_created FROM answer, user

                WHERE user_id = :userId AND asw_user_id = user_id)

            ORDER BY 1
        "/>
    </bean>
</beans>